<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ò–ò</title>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Titillium Web', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
            background: linear-gradient(135deg, #1e1e2f 0%, #2a2a4a 100%);
            color: #ffffff;
        }
        body.light-theme {
            background: linear-gradient(135deg, #f0f0f0 0%, #d9e6ff 100%);
            color: #333;
        }
        .logo {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffffff;
            transition: color 0.3s;
        }
        .light-theme .logo {
            color: #333;
        }
        #themeToggleBtn {
            position: fixed;
            top: 5px;
            right: 20px;
            background: transparent;
            color: inherit;
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #themeToggleBtn:hover {
            transform: scale(1.05);
        }
        .welcome-screen, .container {
            text-align: center;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, box-shadow 0.3s, color 0.3s;
            margin-top: 60px;
        }
        .dark-theme .welcome-screen, .dark-theme .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #ffffff;
        }
        .light-theme .welcome-screen, .light-theme .container {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #333;
        }
        .welcome-screen h1, .container h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .welcome-screen p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #d0d0ff;
        }
        .light-theme .welcome-screen p {
            color: #666;
        }
        .container p {
            font-size: 18px;
            margin-bottom: 20px;
            color: #d0d0ff;
        }
        .light-theme .container p {
            color: #666;
        }
        textarea {
            width: 100%;
            height: 120px;
            margin: 10px 0;
            padding: 15px;
            font-size: 16px;
            font-family: 'Titillium Web', sans-serif;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            resize: vertical;
            transition: background 0.3s, color 0.3s, border 0.3s;
        }
        .dark-theme textarea {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .light-theme textarea {
            background: #ffffff;
            color: #333;
            border: 1px solid #ccc;
        }
        textarea::placeholder {
            color: #a0a0cc;
        }
        .light-theme textarea::placeholder {
            color: #999;
        }
        button {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin: 10px;
        }
        #generateBtn {
            background-color: #007bff;
            color: white;
        }
        #generateBtn:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        #generateBtn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }
        #downloadBtn {
            display: none;
            background-color: #28a745;
            color: white;
        }
        #downloadBtn:hover {
            background-color: #218838;
            transform: scale(1.05);
        }
        #result img {
            max-width: 70%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        #error {
            color: #ff6b6b;
            margin-top: 10px;
            font-weight: 400;
        }
        .loading {
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .dark-theme .loading {
            color: #a0a0cc;
        }
        .light-theme .loading {
            color: #666;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        .light-theme .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #007bff;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .attribution {
            font-size: 12px;
            margin-top: 20px;
            opacity: 0.7;
        }
        .dark-theme .attribution {
            color: #d0d0ff;
        }
        .light-theme .attribution {
            color: #666;
        }
        @media (max-width: 600px) {
            .welcome-screen, .container { padding: 20px; }
            textarea { height: 100px; font-size: 14px; }
            button { padding: 10px 20px; font-size: 14px; }
            h1 { font-size: 24px; }
            p { font-size: 14px; }
            .logo { font-size: 14px; top: 10px; left: 10px; }
            #themeToggleBtn { top: 5px; right: 10px; font-size: 10px; }
            .attribution { font-size: 10px; }
        }
    </style>
</head>
<body class="dark-theme">
    <div class="logo">petrovski.AI</div>
    <button id="themeToggleBtn">üåô</button>
    <div id="g_id_onload" data-client_id="833606171828-0pqd858j8a5fq0umm3e41i5r54ucg13a.apps.googleusercontent.com" data-callback="handleCredentialResponse" data-auto_prompt="false"></div>
    <div class="welcome-screen">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <p>–≠—Ç–æ —Å–∞–π—Ç Petrovski.AI ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –ò–ò. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Google –∏ –Ω–∞—á–Ω–∏—Ç–µ —Ç–≤–æ—Ä–∏—Ç—å!</p>
        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular"></div>
    </div>
    <div class="container">
        <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ò–ò</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "futuristic city in neon lights"):</p>
        <textarea id="prompt" placeholder="–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ..."></textarea>
        <button id="generateBtn" disabled>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="downloadBtn">–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        <div id="result"></div>
        <div id="error"></div>
        <div class="attribution">Powered by Stability AI</div>
    </div>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const welcomeScreen = document.querySelector('.welcome-screen');
        const container = document.querySelector('.container');
        let isAuthenticated = false;

        function handleCredentialResponse(response) {
            console.log('Credential Response:', response);
            const idToken = response.credential;
            if (idToken) {
                isAuthenticated = true;
                welcomeScreen.style.display = 'none';
                container.style.display = 'block';
                console.log('Logged in, isAuthenticated set to:', isAuthenticated);
                document.getElementById('generateBtn').disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            } else {
                console.error('No credential received');
            }
        }

        themeToggleBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            document.body.classList.toggle('light-theme');
            themeToggleBtn.textContent = document.body.classList.contains('dark-theme') ? 'üåô' : '‚òÄÔ∏è';
        });

        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const promptInput = document.getElementById('prompt');
        const resultDiv = document.getElementById('result');
        const errorDiv = document.getElementById('error');
        let currentImageBase64 = null;

        function isRussian(text) {
            return /[–∞-—è–ê-–Ø]/.test(text);
        }

        function sanitizeInput(text) {
            return text.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
        }

        generateBtn.addEventListener('click', async () => {
            console.log('Generate button clicked, isAuthenticated:', isAuthenticated);
            if (!isAuthenticated) {
                errorDiv.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.';
                return;
            }
            let prompt = promptInput.value.trim();
            if (!prompt) {
                errorDiv.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.';
                return;
            }
            prompt = sanitizeInput(prompt);
            if (isRussian(prompt)) {
                errorDiv.textContent = '–î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ "–∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ" –Ω–∞–ø–∏—à–∏—Ç–µ "cat in space".';
                return;
            }
            resultDiv.innerHTML = '';
            errorDiv.textContent = '';
            generateBtn.disabled = true;
            downloadBtn.style.display = 'none';
            resultDiv.innerHTML = '<div class="loading">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è... <div class="spinner"></div></div>';

            try {
                const response = await fetch('https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer sk-QzJZGf1Rendn1quxrPQTO8McKZxiGmf63vtmkRjcb9muQSIn`,
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        text_prompts: [{ text: prompt }],
                        cfg_scale: 7,
                        height: 1024,
                        width: 1024,
                        steps: 30,
                        samples: 1
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status} - ${errorData.message || response.statusText}`);
                }
                const data = await response.json();
                currentImageBase64 = data.artifacts[0].base64;
                resultDiv.innerHTML = `<img src="data:image/png;base64,${currentImageBase64}" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">`;
                downloadBtn.style.display = 'inline-block';
            } catch (error) {
                errorDiv.textContent = `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API-–∫–ª—é—á –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.`;
                console.error('–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ—à–∏–±–∫–∏:', error);
            } finally {
                generateBtn.disabled = false;
                resultDiv.querySelector('.loading')?.remove();
            }
        });

        downloadBtn.addEventListener('click', () => {
            if (currentImageBase64) {
                const link = document.createElement('a');
                link.href = `data:image/png;base64,${currentImageBase64}`;
                link.download = 'generated_image.png';
                link.click();
            }
        });
    </script>
</body>
</html>